import React from 'react'; import styles from './MemoryBar.module.css'; import { motion, AnimatePresence } from 'framer-motion';
interface MemoryBarProps { type: 'Params' | 'Activations' | 'Gradients' | 'OptStates'; value: number; maxValue: number; shardDenom: number; isSharded: boolean; isTempFull?: boolean; }
const MemoryBar: React.FC<MemoryBarProps> = ({ type, value, maxValue, shardDenom, isSharded, isTempFull }) => { const persistentValue = value; const fullValue = isSharded && shardDenom > 0 ? persistentValue * shardDenom : persistentValue; const clampedPersistentValue = Math.min(persistentValue, maxValue); const clampedFullValue = Math.min(fullValue, maxValue); const persistentPercentage = maxValue > 0 ? (clampedPersistentValue / maxValue) * 100 : 0; const shardPercentage = isSharded && shardDenom > 0 ? (1 / shardDenom) * 100 : persistentPercentage; const solidBarPercentage = isSharded ? shardPercentage : persistentPercentage; const displayValue = isTempFull ? clampedFullValue : clampedPersistentValue; const displayMaxValue = maxValue; const shardInfo = isSharded && shardDenom > 0 ? `1/${shardDenom}` : ''; const labelText = `${type}${isSharded ? ` (Shard ${shardInfo})` : ''}:`; const barClass = styles[type.toLowerCase()] || ''; const tempFullVariants = { hidden: { opacity: 0 }, visible: { opacity: 0.35, transition: { duration: 0.15 } }, exit: { opacity: 0, transition: { duration: 0.1 } } };
    return ( <div className={styles.memoryBarContainer} title={`Value: ${displayValue.toFixed(1)} / Max: ${displayMaxValue}${isSharded ? ' (sharded)' : ''}`}> <span className={styles.memoryLabel}>{labelText}</span> <div className={styles.barBackground}> <motion.div className={`${styles.barForeground} ${barClass}`} initial={false} animate={{ width: `${solidBarPercentage}%` }} transition={{ duration: 0.3, ease: "easeInOut" }} /> <AnimatePresence> {isSharded && isTempFull && ( <motion.div key={`${type}-temp-overlay`} className={`${styles.barTempFullOverlay} ${barClass}`} variants={tempFullVariants} initial="hidden" animate="visible" exit="exit" style={{ width: '100%' }} /> )} </AnimatePresence> </div> </div> ); };
export default MemoryBar;
